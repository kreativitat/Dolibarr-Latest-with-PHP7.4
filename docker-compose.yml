version: "3.8"
services:
  dolibarr:
    build:
      context: .
      dockerfile: Dockerfile.dolibarr
    container_name: dolibarr
    ports:
      - "8081:80"
    environment:
      - DOLI_DB_HOST=mariadb
      - DOLI_DB_NAME=degemapt_doli391
      - DOLI_DB_USER=degemapt_doli391
      - DOLI_DB_PASSWORD=Pegasus-3270
      - DOLI_DB_PREFIX=llxnm_
      - DOLI_DB_TYPE=mysqli
      - DOLI_DB_CHARACTER_SET=utf8
      - DOLI_DB_COLLATION=utf8_general_ci
      - DOLI_ADMIN_LOGIN=admin
      - DOLI_ADMIN_PASSWORD=Pegasus-3270
      - TZ=Europe/Lisbon
      - PHP_INI_ERROR_REPORTING=0
      - PHP_INI_DISPLAY_ERRORS=0
      - PHP_INI_LOG_ERRORS=0
    volumes:
      - /home/kreativitat/data/html:/var/www/html
      - /home/kreativitat/data/documents:/var/www/documents
      - /home/kreativitat/data/custom:/var/www/html/custom
    depends_on:
      - mariadb
    restart: unless-stopped

  mariadb:
    image: mariadb:10.6
    container_name: mariadb_server
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=Pegasus-3270
      - TZ=Europe/Lisbon
    volumes:
      - /home/kreativitat/data/database:/var/lib/mysql
      - /home/kreativitat/dolibarr-setup/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  code-server:
    image: codercom/code-server:latest
    container_name: vscode_server
    ports:
      - "8083:8080"
    user: "0:0"
    environment:
      - TZ=Europe/Lisbon
    volumes:
      - /home/kreativitat/data/html:/dolibarr/html
      - /home/kreativitat/data/documents:/dolibarr/documents
      - /home/kreativitat/data/database:/dolibarr/database
      - /home/kreativitat/data/backup:/dolibarr/backup
      - /home/kreativitat/data/custom:/dolibarr/custom
      - /home/kreativitat/dolibarr-setup:/dolibarr/project
    command: ["--bind-addr", "0.0.0.0:8080", "--auth", "none"]
    restart: unless-stopped

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: phpmyadmin
    ports:
      - "8082:80"
    environment:
      - PMA_HOST=mariadb
      - PMA_PORT=3306
      - PMA_USER=root
      - PMA_PASSWORD=Pegasus-3270
      - TZ=Europe/Lisbon
    depends_on:
      - mariadb
    restart: unless-stopped

  duplicati:
    image: duplicati/duplicati:latest
    container_name: duplicati
    ports:
      - "8085:8200"
    environment:
      - TZ=Europe/Lisbon
    volumes:
      - /home/kreativitat/data/duplicati:/data
      - /home/kreativitat/data/backup:/backups
      - /home/kreativitat/data/documents:/source/documents:ro
      - /home/kreativitat/data/database:/source/database:ro
      - /home/kreativitat/data/html:/source/html:ro
      - /home/kreativitat/data/custom:/source/custom:ro
    depends_on:
      - mariadb
      - dolibarr
    restart: unless-stopped
